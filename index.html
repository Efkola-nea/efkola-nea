<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap CSS -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #ffffff;
      font-size: 18px; /* Î»Î¯Î³Î¿ Ï€Î¹Î¿ Î¼ÎµÎ³Î¬Î»Î± Î³ÏÎ¬Î¼Î¼Î±Ï„Î± */
      line-height: 1.6;
    }

    .site-header {
      background: #1d4ed8;
      color: white;
      padding: 1.2rem 0;
      margin-bottom: 1.2rem;
    }

    .site-title {
      font-size: 1.8rem;
      font-weight: 700;
    }

    .site-subtitle {
      font-size: 1rem;
      margin-top: 0.3rem;
      opacity: 0.95;
    }

    .article-card {
      border-radius: 16px;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.08);
      border: 1px solid #e5e7eb;
      background-color: #f9fafb;
    }

    .article-card h2 {
      font-size: 1.25rem;
      font-weight: 700;
    }

    .article-text {
      font-size: 1rem;
    }

    .source {
      font-size: 0.9rem;
      color: #4b5563;
    }

    #status {
      text-align: center;
      color: #4b5563;
      margin-bottom: 1rem;
    }

    .btn-listen {
      font-size: 0.95rem;
    }

    /* ===== Weather widget ===== */
    .weather-card {
      border-radius: 18px;
      border: 1px solid #bfdbfe;
      background: #eff6ff;
      box-shadow: 0 2px 6px rgba(37, 99, 235, 0.15);
    }

    .weather-icon {
      font-size: 2.6rem;
      line-height: 1;
    }

    .weather-title {
      font-size: 1.1rem;
      font-weight: 600;
      margin-bottom: 0.15rem;
    }

    .weather-text-main {
      font-size: 1rem;
    }

    .weather-text-sub {
      font-size: 0.95rem;
      color: #4b5563;
      margin-top: 0.15rem;
    }
  </style>
</head>
<body>
  <!-- Î•Ï€Î¬Î½Ï‰ Î¼Ï€Î¬ÏÎ± -->
  <header class="site-header">
    <div class="container">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-2">
        <div>
          <div class="site-title">ğŸ“° Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</div>
          <div class="site-subtitle">ÎŸÎ¹ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ ÏƒÎµ Î±Ï€Î»Î¬ ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬</div>
        </div>
        <div class="text-md-end">
          <span class="badge bg-light text-dark">Î“Î¹Î± Î¬Ï„Î¿Î¼Î± Î¼Îµ Î½Î¿Î·Ï„Î¹ÎºÎ® Ï…ÏƒÏ„Î­ÏÎ·ÏƒÎ·</span>
        </div>
      </div>
    </div>
  </header>

  <!-- Î ÎµÏÎ¹ÎµÏ‡ÏŒÎ¼ÎµÎ½Î¿ -->
  <main class="container mb-5">

    <!-- ğŸ”† WEATHER WIDGET Î Î‘ÎÎ© Î‘Î ÎŸ Î¤Î™Î£ Î•Î™Î”Î—Î£Î•Î™Î£ -->
    <section class="mb-4">
      <div class="card weather-card">
        <div class="card-body d-flex align-items-center gap-3">
          <div id="weather-icon" class="weather-icon">â›…</div>
          <div class="flex-grow-1">
            <div class="weather-title">ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ ÏƒÎ®Î¼ÎµÏÎ± ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ¿Ï…</div>
            <div id="weather-text" class="weather-text-main">
              Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¿Î½ ÎºÎ±Î¹ÏÏŒâ€¦
            </div>
            <div id="weather-subtext" class="weather-text-sub"></div>
          </div>
        </div>
      </div>
    </section>

    <p id="status">Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¹Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚â€¦</p>

    <div id="news" class="row g-3">
      <!-- ÎµÎ´Ï Î¸Î± Î¼Ï€Î¿Ï…Î½ Î¿Î¹ ÎºÎ¬ÏÏ„ÎµÏ‚ -->
    </div>
  </main>

  <script>
    let globalArticles = [];

    function cleanMarkdown(text) {
      if (!text) return "";
      return text
        .replace(/\*\*(.+?)\*\*/g, "$1")
        .replace(/###\s*/g, "")
        .trim();
    }

    function speak(text) {
      if (!("speechSynthesis" in window)) {
        alert("ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….");
        return;
      }
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "el-GR"; // ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬, Î±Î½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼ÎµÏ‚ Ï†Ï‰Î½Î­Ï‚
      window.speechSynthesis.speak(utterance);
    }

    /* ===== Î’ÎŸÎ—Î˜Î—Î¤Î™ÎšÎ•Î£ Î£Î¥ÎÎ‘Î¡Î¤Î—Î£Î•Î™Î£ ÎšÎ‘Î™Î¡ÎŸÎ¥ (Ï‡Ï‰ÏÎ¯Ï‚ Î½Î¿ÏÎ¼ÎµÏÎ± ÏƒÏ„Î¿Î½ Ï‡ÏÎ®ÏƒÏ„Î·) ===== */

    function mapWeatherToIconAndSky(code) {
      if (code === 0) {
        return { icon: "â˜€ï¸", sky: "ÎºÎ±Î¸Î±ÏÏŒÏ‚" };
      }
      if (code === 1 || code === 2 || code === 3) {
        return { icon: "â›…", sky: "Î¼Îµ Î»Î¯Î³Î± ÏƒÏÎ½Î½ÎµÏ†Î±" };
      }
      if (code === 45 || code === 48) {
        return { icon: "ğŸŒ«ï¸", sky: "Î¼Îµ Î¿Î¼Î¯Ï‡Î»Î·" };
      }
      if ([51, 53, 55, 56, 57].includes(code)) {
        return { icon: "ğŸŒ¦ï¸", sky: "Î¼Îµ ÏˆÎ¹Î»Î® Î²ÏÎ¿Ï‡Î®" };
      }
      if ([61, 63, 65, 80, 81, 82].includes(code)) {
        return { icon: "ğŸŒ§ï¸", sky: "Î¼Îµ Î²ÏÎ¿Ï‡Î®" };
      }
      if ([71, 73, 75, 77, 85, 86].includes(code)) {
        return { icon: "ğŸŒ¨ï¸", sky: "Î¼Îµ Ï‡Î¹ÏŒÎ½Î¹" };
      }
      if ([95, 96, 99].includes(code)) {
        return { icon: "â›ˆï¸", sky: "Î¼Îµ ÎºÎ±Ï„Î±Î¹Î³Î¯Î´Î±" };
      }
      return { icon: "ğŸŒˆ", sky: "Î¬Î³Î½Ï‰ÏƒÏ„Î¿Ï‚" };
    }

    function describeTemperature(temp) {
      if (typeof temp !== "number" || isNaN(temp)) {
        return "Î”ÎµÎ½ Î¾Î­ÏÎ¿Ï…Î¼Îµ Î±ÎºÏÎ¹Î²ÏÏ‚ Ï€ÏŒÏƒÎ¿ Î¶Î­ÏƒÏ„Î· Î® ÎºÏÏÎ¿ ÎºÎ¬Î½ÎµÎ¹.";
      }
      if (temp <= 5) {
        return "ÎšÎ¬Î½ÎµÎ¹ Ï€Î¿Î»Ï ÎºÏÏÎ¿.";
      }
      if (temp <= 15) {
        return "ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ ÎºÏÏÎ¿Ï‚.";
      }
      if (temp <= 25) {
        return "ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î®Ï€Î¹Î¿Ï‚.";
      }
      if (temp <= 32) {
        return "ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ Î¶ÎµÏƒÏ„ÏŒÏ‚.";
      }
      return "ÎšÎ¬Î½ÎµÎ¹ Ï€Î¿Î»Ï Î¶Î­ÏƒÏ„Î·.";
    }

    function describeRain(precip) {
      if (typeof precip !== "number" || isNaN(precip)) {
        return "Î”ÎµÎ½ Î¾Î­ÏÎ¿Ï…Î¼Îµ Î±Î½ Î¸Î± Î²ÏÎ­Î¾ÎµÎ¹.";
      }
      if (precip === 0) {
        return "Î¤ÏÏÎ± Î´ÎµÎ½ Ï†Î±Î¯Î½ÎµÏ„Î±Î¹ Î½Î± Î²ÏÎ­Ï‡ÎµÎ¹.";
      }
      if (precip < 1) {
        return "ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Ï€Î­ÏƒÎµÎ¹ Î»Î¯Î³Î· Î²ÏÎ¿Ï‡Î®.";
      }
      return "ÎœÏ€Î¿ÏÎµÎ¯ Î½Î± Î²ÏÎ­Î¾ÎµÎ¹ Î´Ï…Î½Î±Ï„Î¬. ÎšÎ±Î»ÏŒ ÎµÎ¯Î½Î±Î¹ Î½Î± Î­Ï‡ÎµÎ¹Ï‚ Î¼Î±Î¶Î¯ ÏƒÎ¿Ï… Î¿Î¼Ï€ÏÎ­Î»Î±.";
    }

    // 1ï¸âƒ£ Î ÏÎ¿ÏƒÏ€Î¬Î¸ÎµÎ¹Î±: browser geolocation (Î¼Îµ Î¬Î´ÎµÎ¹Î± Ï‡ÏÎ®ÏƒÏ„Î·)
    async function getLocationFromBrowser() {
      if (!("geolocation" in navigator)) {
        return null;
      }

      return new Promise((resolve) => {
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            resolve({
              lat: pos.coords.latitude,
              lon: pos.coords.longitude,
              city: null,
            });
          },
          (err) => {
            console.warn("Geolocation error:", err);
            resolve(null);
          },
          {
            enableHighAccuracy: false,
            timeout: 7000,
            maximumAge: 10 * 60 * 1000,
          }
        );
      });
    }

    // 2ï¸âƒ£ Fallback: IP geolocation
    async function getLocationFromIp() {
      try {
        const res = await fetch("https://ipapi.co/json/");
        if (!res.ok) throw new Error("HTTP " + res.status);
        const data = await res.json();
        if (
          data &&
          typeof data.latitude === "number" &&
          typeof data.longitude === "number"
        ) {
          return {
            lat: data.latitude,
            lon: data.longitude,
            city: data.city || null,
          };
        }
      } catch (err) {
        console.error("IP geolocation failed:", err);
      }
      return null;
    }

    // 3ï¸âƒ£ Î¤ÎµÎ»Î¹ÎºÎ® ÎµÏ€Î¯Î»Ï…ÏƒÎ· Î¸Î­ÏƒÎ·Ï‚ Ï‡ÏÎ®ÏƒÏ„Î·
    async function resolveUserLocation() {
      const browserLoc = await getLocationFromBrowser();
      if (browserLoc) return browserLoc;

      const ipLoc = await getLocationFromIp();
      if (ipLoc) return ipLoc;

      // Fallback: Î‘Î¸Î®Î½Î±
      return {
        lat: 37.98,
        lon: 23.72,
        city: "Î‘Î¸Î®Î½Î±",
      };
    }

    async function loadWeather() {
      const iconEl = document.getElementById("weather-icon");
      const mainEl = document.getElementById("weather-text");
      const subEl = document.getElementById("weather-subtext");

      try {
        const loc = await resolveUserLocation();

        const url =
          "https://api.open-meteo.com/v1/forecast" +
          "?latitude=" + loc.lat +
          "&longitude=" + loc.lon +
          "&current=temperature_2m,apparent_temperature,weather_code,precipitation" +
          "&timezone=auto";

        const res = await fetch(url);
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const current = data && data.current;
        if (!current) {
          throw new Error("Î§Ï‰ÏÎ¯Ï‚ current weather ÏƒÏ„Î¿ API.");
        }

        const code = current.weather_code;
        const temp =
          typeof current.apparent_temperature === "number"
            ? current.apparent_temperature
            : current.temperature_2m;
        const precip = current.precipitation;

        const tempText = describeTemperature(temp);
        const rainText = describeRain(precip);
        const { icon, sky } = mapWeatherToIconAndSky(code);

        iconEl.textContent = icon;
        // Î”ÎµÎ½ Î±Î½Î±Ï†Î­ÏÎ¿Ï…Î¼Îµ Î½Î¿ÏÎ¼ÎµÏÎ± Î® ÏƒÏ…Î³ÎºÎµÎºÏÎ¹Î¼Î­Î½Î· Ï€ÏŒÎ»Î· â†’ "ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ¿Ï…"
        mainEl.textContent =
          "ÎŸ ÎºÎ±Î¹ÏÏŒÏ‚ ÏƒÏ„Î·Î½ Ï€ÎµÏÎ¹Î¿Ï‡Î® ÏƒÎ¿Ï… ÏƒÎ®Î¼ÎµÏÎ±. " +
          tempText +
          " ÎŸ Î¿Ï…ÏÎ±Î½ÏŒÏ‚ ÎµÎ¯Î½Î±Î¹ " +
          sky +
          ".";
        subEl.textContent = rainText;
      } catch (err) {
        console.error(err);
        iconEl.textContent = "";
        mainEl.textContent = "Î”ÎµÎ½ Î¼Ï€Î¿ÏÏ Î½Î± Î´ÎµÎ¯Î¾Ï‰ Ï„Î¿Î½ ÎºÎ±Î¹ÏÏŒ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
        subEl.textContent = "Î ÏÎ¿ÏƒÏ€Î¬Î¸Î·ÏƒÎµ Î¾Î±Î½Î¬ Î±ÏÎ³ÏŒÏ„ÎµÏÎ±.";
      }
    }

    /* ===== Î•Î™Î”Î—Î£Î•Î™Î£ ===== */

    async function loadNews() {
      const statusEl = document.getElementById("status");
      const container = document.getElementById("news");

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const articles = (data && data.articles) || [];
        globalArticles = articles;

        if (!articles.length) {
          statusEl.textContent = "Î ÏÎ¿Ï‚ Ï„Î¿ Ï€Î±ÏÏŒÎ½ Î´ÎµÎ½ Ï…Ï€Î¬ÏÏ‡Î¿Ï…Î½ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚.";
          return;
        }

        statusEl.textContent = "";

        articles.forEach((a, index) => {
          const col = document.createElement("div");
          col.className = "col-12";

          const card = document.createElement("div");
          card.className = "card article-card";

          const cardBody = document.createElement("div");
          cardBody.className = "card-body";

          const title = document.createElement("h2");
          title.className = "card-title mb-2";
          title.textContent = a.title || "";

          const textP = document.createElement("p");
          textP.className = "card-text article-text";
          const cleaned = cleanMarkdown(a.simpleText || "");
          textP.innerHTML = cleaned.replace(/\n/g, "<br/>");

          const footer = document.createElement("div");
          footer.className =
            "d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-3";

          const sourceName = a.sourceName || "Î Î·Î³Î®";
          const sourceUrl = a.sourceUrl || "#";

          const sourceEl = document.createElement("p");
          sourceEl.className = "source mb-0";
          sourceEl.innerHTML =
            'Î Î·Î³Î®: <a href="' +
            sourceUrl +
            '" target="_blank" rel="noopener noreferrer">' +
            sourceName +
            "</a>";

          const listenBtn = document.createElement("button");
          listenBtn.type = "button";
          listenBtn.className = "btn btn-sm btn-primary btn-listen";
          listenBtn.textContent = "Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·";
          listenBtn.onclick = () => {
            const toRead = (a.title || "") + ". " + cleaned;
            speak(toRead);
          };

          footer.appendChild(sourceEl);
          footer.appendChild(listenBtn);

          cardBody.appendChild(title);
          cardBody.appendChild(textP);
          cardBody.appendChild(footer);
          card.appendChild(cardBody);
          col.appendChild(card);
          container.appendChild(col);
        });
      } catch (err) {
        console.error(err);
        statusEl.textContent =
          "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ Ï€ÏÏŒÎ²Î»Î·Î¼Î± ÎºÎ±Ï„Î¬ Ï„Î· Ï†ÏŒÏÏ„Ï‰ÏƒÎ· Ï„Ï‰Î½ ÎµÎ¹Î´Î®ÏƒÎµÏ‰Î½: " + err.message;
      }
    }

    // Î¦ÏŒÏÏ„Ï‰ÏƒÎ· ÎºÎ±Î¹ÏÎ¿Ï + ÎµÎ¹Î´Î®ÏƒÎµÏ‰Î½
    loadWeather();
    loadNews();
  </script>
</body>
</html>


