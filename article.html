<!DOCTYPE html>
<html lang="el">
<head>
  <meta charset="UTF-8" />
  <title>Î†ÏÎ¸ÏÎ¿ - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous"
  />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background-color: #e5e7eb;
      font-size: 18px;
      line-height: 1.6;
      position: relative;
    }

    .article-bg {
      position: fixed;
      inset: 0;
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      opacity: 0.12;
      z-index: -1;
      filter: blur(1px);
    }

    .site-header {
      background: #1d4ed8;
      color: white;
      padding: 1rem 0;
      margin-bottom: 1.2rem;
      box-shadow: 0 2px 8px rgba(15, 23, 42, 0.3);
    }

    .site-title {
      font-size: 1.6rem;
      font-weight: 800;
    }

    .page-wrapper {
      max-width: 800px;
      margin: 0 auto;
    }

    .article-main-card {
      border-radius: 20px;
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.15);
      padding: 1.2rem 1.4rem;
    }

    .article-main-title {
      font-size: 1.5rem;
      font-weight: 800;
      margin-bottom: 0.8rem;
      color: #111827;
    }

    .article-image-wrapper {
      width: 100%;
      aspect-ratio: 16 / 9;
      background-color: #e5e7eb;
      overflow: hidden;
      border-radius: 16px;
      margin-bottom: 1rem;
    }

    .article-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .article-video-wrapper {
      width: 100%;
      margin-bottom: 1rem;
    }

    .article-video {
      width: 100%;
      aspect-ratio: 16 / 9;
      border-radius: 16px;
      border: none;
      background-color: #000;
      display: block;
    }

    .article-body {
      font-size: 1.05rem;
      color: #111827;
      margin-bottom: 1rem;
    }

    .source {
      font-size: 0.95rem;
      color: #4b5563;
    }

    .btn-listen {
      font-size: 0.98rem;
      border-radius: 999px;
      padding-inline: 1.2rem;
      font-weight: 600;
    }
  </style>
</head>
<body>
  <!-- full-screen background Î³Î¹Î± ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚ -->
  <div id="article-bg" class="article-bg" style="display:none;"></div>

  <header class="site-header">
    <div class="container page-wrapper d-flex justify-content-between align-items-center">
      <div class="site-title">ğŸ“° Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚</div>
      <a href="index.html" class="btn btn-sm btn-light">
        â† Î Î¯ÏƒÏ‰ ÏƒÏ„Î¹Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚
      </a>
    </div>
  </header>

  <main class="container mb-5">
    <div class="page-wrapper">
      <article class="article-main-card">
        <h1 id="article-title" class="article-main-title">Î¦Î¿ÏÏ„ÏÎ½Ï‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿â€¦</h1>

        <!-- Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï… (news.json) -->
        <div id="article-image-wrapper" class="article-image-wrapper" style="display:none;">
          <img id="article-image" class="article-image" alt="Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…" />
        </div>

        <!-- Î’Î¯Î½Ï„ÎµÎ¿ Î¬ÏÎ¸ÏÎ¿Ï… (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹) -->
        <div id="article-video-wrapper" class="article-video-wrapper" style="display:none;">
          <div id="article-video-container"></div>
        </div>

        <div id="article-body" class="article-body">
          Î Î±ÏÎ±ÎºÎ±Î»Ï Ï€ÎµÏÎ¯Î¼ÎµÎ½Îµ Î»Î¯Î³Î¿â€¦
        </div>

        <div class="d-flex flex-column flex-md-row justify-content-between align-items-md-center gap-2 mt-3">
          <p id="article-source" class="source mb-0"></p>
          <button id="listen-btn" type="button" class="btn btn-primary btn-listen">
            Î†ÎºÎ¿Ï… Ï„Î·Î½ ÎµÎ¯Î´Î·ÏƒÎ·
          </button>
        </div>
      </article>
    </div>
  </main>

  <script>
    function escapeHtml(str) {
      if (!str) return "";
      return String(str)
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#39;");
    }

    function cleanMarkdown(text) {
      if (!text) return "";
      return text
        .replace(/\*\*(.+?)\*\*/g, "$1")
        .replace(/###\s*/g, "")
        .trim();
    }

    function speak(text) {
      if (!("speechSynthesis" in window)) {
        alert("ÎŸ Ï€ÎµÏÎ¹Î·Î³Î·Ï„Î®Ï‚ Î´ÎµÎ½ Ï…Ï€Î¿ÏƒÏ„Î·ÏÎ¯Î¶ÎµÎ¹ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ· ÎºÎµÎ¹Î¼Î­Î½Î¿Ï….");
        return;
      }
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "el-GR";
      window.speechSynthesis.speak(utterance);
    }

    function seriousBackgroundForTopic(topic) {
      switch (topic) {
        case "politics_economy":
          return "images/serious/politics.png";
        case "social":
          return "images/serious/social.png";
        case "world":
          return "images/serious/world.png";
        default:
          return null;
      }
    }

    function setSeriousBackground(topic) {
      const bgEl = document.getElementById("article-bg");
      if (!bgEl) return;
      const url = seriousBackgroundForTopic(topic);
      if (!url) {
        bgEl.style.display = "none";
        bgEl.style.backgroundImage = "";
        return;
      }
      bgEl.style.backgroundImage = "url('" + url + "')";
      bgEl.style.display = "block";
    }

    function renderSources(sourceEl, article) {
      const sources = Array.isArray(article.sources) ? article.sources : [];
      const fallbackName = article.sourceName || "Î Î·Î³Î®";
      const fallbackUrl = article.sourceUrl || "#";

      if (sources.length === 0) {
        const safeName = escapeHtml(fallbackName);
        const safeUrl = escapeHtml(fallbackUrl);
        sourceEl.innerHTML =
          'Î Î·Î³Î®: <a href="' +
          safeUrl +
          '" target="_blank" rel="noopener noreferrer">' +
          safeName +
          "</a>";
      } else if (sources.length === 1) {
        const s = sources[0];
        const safeName = escapeHtml(s.sourceName || fallbackName);
        const safeUrl = escapeHtml(s.sourceUrl || fallbackUrl);
        sourceEl.innerHTML =
          'Î Î·Î³Î®: <a href="' +
          safeUrl +
          '" target="_blank" rel="noopener noreferrer">' +
          safeName +
          "</a>";
      } else {
        const links = sources.map((s) => {
          const name = escapeHtml(s.sourceName || "Î Î·Î³Î®");
          const url = escapeHtml(s.sourceUrl || "#");
          return (
            '<a href="' +
            url +
            '" target="_blank" rel="noopener noreferrer">' +
            name +
            "</a>"
          );
        });
        sourceEl.innerHTML = "Î Î·Î³Î­Ï‚: " + links.join(", ");
      }
    }

    async function loadNewsArticle({
      idParam,
      titleEl,
      bodyEl,
      sourceEl,
      imageWrapper,
      imageEl,
      videoWrapper,
      videoContainer,
      listenBtn,
    }) {
      if (!idParam) {
        titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
        bodyEl.textContent = "Î›ÎµÎ¯Ï€ÎµÎ¹ Ï„Î¿ Î±Î½Î±Î³Î½Ï‰ÏÎ¹ÏƒÏ„Î¹ÎºÏŒ Ï„Î¿Ï… Î¬ÏÎ¸ÏÎ¿Ï… (id).";
        listenBtn.disabled = true;
        return;
      }

      try {
        const res = await fetch("news.json?cachebust=" + Date.now());
        if (!res.ok) {
          throw new Error("HTTP " + res.status);
        }

        const data = await res.json();
        const articles = (data && data.articles) || [];

        let article = articles.find((a) => String(a.id) === String(idParam));

        if (!article) {
          const idx = Number(idParam);
          if (!Number.isNaN(idx) && idx >= 0 && idx < articles.length) {
            article = articles[idx];
          }
        }

        if (!article) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿";
          bodyEl.textContent = "ÎŠÏƒÏ‰Ï‚ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ Î½Î± Î­Ï‡ÎµÎ¹ Î±Ï†Î±Î¹ÏÎµÎ¸ÎµÎ¯.";
          listenBtn.disabled = true;
          return;
        }

        const displayTitle = article.simpleTitle || article.title || "";
        const cleaned = cleanMarkdown(article.simpleText || "");

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Î•Î¹ÎºÏŒÎ½Î±
        if (article.imageUrl) {
          imageEl.src = article.imageUrl;
          imageEl.alt = displayTitle || "Î•Î¹ÎºÏŒÎ½Î± Î¬ÏÎ¸ÏÎ¿Ï…";
          imageWrapper.style.display = "block";
        }

        // Î’Î¯Î½Ï„ÎµÎ¿ (Î±Î½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ videoUrl ÏƒÏ„Î¿ JSON)
        if (article.videoUrl) {
          let node;
          const url = article.videoUrl;

          if (/\.(mp4|webm|ogg)(\?|$)/i.test(url)) {
            node = document.createElement("video");
            node.className = "article-video";
            node.controls = true;

            const source = document.createElement("source");
            source.src = url;
            node.appendChild(source);
          } else {
            node = document.createElement("iframe");
            node.className = "article-video";
            node.src = url;
            node.loading = "lazy";
            node.allowFullscreen = true;
            node.setAttribute("frameborder", "0");
            node.setAttribute(
              "allow",
              "accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
            );
          }

          videoContainer.appendChild(node);
          videoWrapper.style.display = "block";
        }

        // Î Î·Î³Î­Ï‚ (Î±Ï€ÏŒ news.json)
        renderSources(sourceEl, article);

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        listenBtn.addEventListener("click", () => {
          const toRead = displayTitle + ". " + cleaned;
          speak(toRead);
        });
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent = "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿: " + err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadSeriousArticle({
      idParam,
      topicParam,
      titleEl,
      bodyEl,
      sourceEl,
      listenBtn,
    }) {
      try {
        const digestRes = await fetch(
          "serious-digest.json?cachebust=" + Date.now()
        );
        if (!digestRes.ok) {
          throw new Error("HTTP " + digestRes.status);
        }
        const digestData = await digestRes.json();
        const digestArticles = Array.isArray(digestData.articles)
          ? digestData.articles
          : [];

        if (!digestArticles.length) {
          titleEl.textContent = "Î”ÎµÎ½ Î²ÏÎ­Î¸Î·ÎºÎ±Î½ ÏƒÎ¿Î²Î±ÏÎ­Ï‚ ÎµÎ¹Î´Î®ÏƒÎµÎ¹Ï‚";
          bodyEl.textContent =
            "Î”ÎµÎ½ Ï…Ï€Î¬ÏÏ‡ÎµÎ¹ Î´Î¹Î±Î¸Î­ÏƒÎ¹Î¼Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚ Î±Ï…Ï„Î® Ï„Î· ÏƒÏ„Î¹Î³Î¼Î®.";
          listenBtn.disabled = true;
          return;
        }

        let article = null;

        if (idParam) {
          article = digestArticles.find(
            (a) => String(a.id) === String(idParam)
          );
        }
        if (!article && topicParam) {
          article = digestArticles.find((a) => a.topic === topicParam);
        }
        if (!article) {
          article = digestArticles[0];
        }

        const displayTitle = article.title || "Î£Î¿Î²Î±ÏÎ® ÎµÎ¯Î´Î·ÏƒÎ·";
        const cleaned = cleanMarkdown(article.simpleText || "");

        // background Î±Î½Î¬ topic
        if (article.topic) {
          setSeriousBackground(article.topic);
        }

        titleEl.textContent = displayTitle;
        bodyEl.innerHTML = cleaned.replace(/\n/g, "<br/>");

        // Ï€ÏÎ¿ÏƒÏ€Î±Î¸Î¿ÏÎ¼Îµ Î½Î± Î²ÏÎ¿ÏÎ¼Îµ Ï€Î·Î³Î­Ï‚ Î±Ï€ÏŒ Ï„Î¿ news.json (mainArticleId)
        if (article.mainArticleId) {
          try {
            const newsRes = await fetch("news.json?cachebust=" + Date.now());
            if (newsRes.ok) {
              const newsData = await newsRes.json();
              const allNews = Array.isArray(newsData.articles)
                ? newsData.articles
                : [];
              const mainSourceArticle = allNews.find(
                (a) => String(a.id) === String(article.mainArticleId)
              );
              if (mainSourceArticle) {
                renderSources(sourceEl, mainSourceArticle);
              } else {
                sourceEl.textContent =
                  "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚.";
              }
            } else {
              sourceEl.textContent =
                "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚.";
            }
          } catch (e) {
            console.error("Î£Ï†Î¬Î»Î¼Î± Ï†ÏŒÏÏ„Ï‰ÏƒÎ·Ï‚ news.json Î³Î¹Î± Ï„Î¹Ï‚ Ï€Î·Î³Î­Ï‚:", e);
            sourceEl.textContent =
              "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚.";
          }
        } else {
          sourceEl.textContent =
            "Î’Î±ÏƒÎ¹ÏƒÎ¼Î­Î½Î¿ ÏƒÎµ Ï€Î¿Î»Î»Î­Ï‚ ÎµÎ»Î»Î·Î½Î¹ÎºÎ­Ï‚ ÎµÎ¹Î´Î·ÏƒÎµÎ¿Î³ÏÎ±Ï†Î¹ÎºÎ­Ï‚ Ï€Î·Î³Î­Ï‚.";
        }

        document.title = displayTitle + " - Î•ÏÎºÎ¿Î»ÎµÏ‚ Î•Î¹Î´Î®ÏƒÎµÎ¹Ï‚";

        listenBtn.addEventListener("click", () => {
          const toRead = displayTitle + ". " + cleaned;
          speak(toRead);
        });
      } catch (err) {
        console.error(err);
        titleEl.textContent = "Î ÏÎ¿Î­ÎºÏ…ÏˆÎµ ÏƒÏ†Î¬Î»Î¼Î±";
        bodyEl.textContent =
          "Î”ÎµÎ½ Î¼Ï€ÏŒÏÎµÏƒÎ± Î½Î± Ï†Î¿ÏÏ„ÏÏƒÏ‰ Ï„Î¿ Î¬ÏÎ¸ÏÎ¿ ÏƒÎ¿Î²Î±ÏÎ®Ï‚ ÎµÏ€Î¹ÎºÎ±Î¹ÏÏŒÏ„Î·Ï„Î±Ï‚: " +
          err.message;
        listenBtn.disabled = true;
      }
    }

    async function loadArticle() {
      const params = new URLSearchParams(window.location.search);
      const source = params.get("source") || "news";
      const idParam = params.get("id");
      const topicParam = params.get("topic");

      const titleEl = document.getElementById("article-title");
      const bodyEl = document.getElementById("article-body");
      const sourceEl = document.getElementById("article-source");
      const imageWrapper = document.getElementById("article-image-wrapper");
      const imageEl = document.getElementById("article-image");
      const videoWrapper = document.getElementById("article-video-wrapper");
      const videoContainer = document.getElementById("article-video-container");
      const listenBtn = document.getElementById("listen-btn");

      if (source === "serious") {
        // Î£Î¿Î²Î±ÏÎ® Î¸ÎµÎ¼Î±Ï„Î¹ÎºÎ® Î±Ï€ÏŒ serious-digest.json
        await loadSeriousArticle({
          idParam,
          topicParam,
          titleEl,
          bodyEl,
          sourceEl,
          listenBtn,
        });
      } else {
        // ÎšÎ»Î±ÏƒÎ¹ÎºÏŒ Î¬ÏÎ¸ÏÎ¿ Î±Ï€ÏŒ news.json
        await loadNewsArticle({
          idParam,
          titleEl,
          bodyEl,
          sourceEl,
          imageWrapper,
          imageEl,
          videoWrapper,
          videoContainer,
          listenBtn,
        });
      }
    }

    document.addEventListener("DOMContentLoaded", loadArticle);
  </script>
</body>
</html>

